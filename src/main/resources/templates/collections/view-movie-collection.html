<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html">
<head th:replace="~{fragments :: head}"></head>
<div th:replace="fragments :: page-header"></div>
<script>window.onload = screenMode()</script>

<body class="container body-content view-movie-collection">

<h1 class="text-center" th:text="${movieCollection.name}"></h1>
<h4 class="text-center">
    <span th:text="'This Movie Collection Belongs To: '"></span><a th:href="@{'/collector/' + ${movieCollection.getUser().getId()}}" th:text="${movieCollection.getUser().getScreenName()}"></a>
</h4>
<br>

<div th:if="${movieCollection.movies.size > 2}">
    <swiper-container class="mySwiper" navigation="true" slides-per-view="3" space-between="10" free-mode="true" style="height:50%">
        <swiper-slide th:each="movie : ${movieCollection.movies}">
            <img th:src="${movie.imageURL}" height="50%">
        </swiper-slide>
    </swiper-container>
</div>


<div th:if="${movieCollection.description != ''}" class="container" style="width: 40rem;">
    <H2 class="text-center" th:text="Description"></H2>
    <i>
        <H3 class="card text-center" th:text="${movieCollection.description}"></H3>
    </i>
</div>

<div th:else>
    <br>
    <br>
</div>

<div style="background-color:transparent">
<table class="table" id="table">
    <thead>
        <tr>
            <th class="col-lg-2 text-center" id="movieImageHeader">Movie</th>
            <th class="col-lg-2 text-center" id="movieTitleHeader">Title</th>
            <th class="col-lg-2 text-center" id="movieYearHeader">Year</th>
            <th class="col-lg-2 text-center" id="movieDirectorHeader">Director</th>
            <th class="col-lg-2 text-center" id="movieGenreHeader">Genre(s)</th>
        </tr>
    </thead>
    <span th:each="movie : ${movieCollection.movies}">
         <tr>
            <td td class="text-left" colspan="5" bgcolor="transparent" border-color="transparent" >

            </td>
        </tr>

        <tr>
            <td class="text-center" rowspan="2">
                <img height="170px" th:src="${movie.imageURL}" alt="movie image">
            </td>
            <td  class="text-center">
                <span th:text="${movie.title}"></span>
            </td>
            <td  class="text-center">
                <span th:text="${movie.year}"></span>
            </td>
            <td class="text-center">
                <span th:text="${movie.director}"></span>
            </td>
            <td class="text-center">
                <span th:text="${movie.genre}"></span> <br/>
                <span th:text="${movie.genre2}"></span><br/>
                <span th:text="${movie.genre3}"></span>
            </td>
        </tr>
        <tr>
            <td td class="text-left" colspan="4" th:each="movieSideNote : ${allMovieSideNotes}" th:if="${movieSideNote.moviesId == movie.id and movieSideNote.movieCollectionId == movieCollection.id}">
                <i>
                    <H4 style="white-space: pre-wrap;" th:text="${movieSideNote.movieSideNote}"></H4>
                </i>
            </td>
        </tr>
        <span th:if="${movieCollection.user.id == userId}">
            <tr class="addNoteRow" >
                <td class="text-center" colspan="5">
                    <form method="post">
                        <input th:id="movieAddId" class="movieAdd" type="text" name="moviesId" th:value="${movie.id}" th:attr="value=${movie.id}" hidden>
                            <div>
                                <h4 th:id="'Movie Sidenote Label ' + ${movie.id}">▶ Create a Sidenote</h4>
                            </div>
                        <div th:display="hidden">

                                <textarea style="color:black" class="movieAddText" name="movieSideNote"  th:id="'Movie Sidenote Text ' + ${movie.id}" rows="5" cols="50" oninput="validateAddSideNote(this)"></textarea>
                        </div>
                            <div>
                                <br>
                                <input type="hidden" th:id="'Movie Sidenote Submit ' + ${movie.id}" value="Add SideNote" th:display="hidden">
                                <button th:id="'Clear Button ' + ${movie.id}" type="button">Clear input</button>
                            </div>

                    </form>
                </td>
            </tr>

            <tr id="movieSideNoteEdit" class="sideNoteRow" th:each="movieSideNote : ${allMovieSideNotes}" th:if="${movieSideNote.moviesId == movie.id and movieSideNote.movieCollectionId == movieCollection.id}">
                <td id="movieSideNoteEdit2" class="text-center" colspan="5">

                        <input id="movieEditId" class="movieEdit" type="text" name="moviesId" th:value="${movie.id}" th:attr="value=${movie.id}" hidden>
                            <div>
                                <h4 th:id="'Movie Sidenote Update Label ' + ${movie.id}">▶ Edit Sidenote </h4>
                            </div>


                         <div style="display: none" th:id="'Movie Sidenote Edit Form ' + ${movie.id}">
                         <form method="post">
                         <textarea style="color:black" class="movieEditText" th:text="${movieSideNote.movieSideNote}" name="movieSideNote" th:value="${movieSideNote.movieSideNote}" th:id="'Movie Sidenote Text To Edit ' + ${movie.id}" rows="5" cols="50" ><!--oninput="validateSideNoteEdit(this)"-->></textarea>
                         <div>
                                <br>
                                <input type="hidden" th:id="'Movie Sidenote Update ' + ${movie.id}" value="Update Sidenote" th:display="hidden">
                                <button th:id="'Clear Button ' + ${movie.id}" type="button">Clear input</button>
                            </div>
                     </form>
                    <form method="post" th:action="@{/collections/deleteMovieSideNote/{movieCollectionId}(movieCollectionId=${movieCollectionId})}">
                        <input id="movieDeleteId" class="movieDelete" type="text" name="moviesId" th:value="${movie.id}" th:attr="value=${movie.id}" hidden>
                        <br>
                        <input type="submit" value="Delete this Sidenote">
                    </form>
                    /</div>
                 </td>
            </tr>

        </span>
    </span>
</table>
</div>

<script>
function toggleAddMovieSideNoteDisplay(){
    const sideNoteRows = document.getElementsByClassName("sideNoteRow");
    const addNoteRows = document.getElementsByClassName("addNoteRow");
    const movieEdits = document.getElementsByClassName("movieEdit");
    const movieAdds = document.getElementsByClassName("movieAdd");

    for (let i =0; i < sideNoteRows.length; i++){
        if (sideNoteRows[i].innerHTML){
            sideNoteRows[i].style.backgroundColor = "Onyx";
            for (let j = 0; j < addNoteRows.length; j++){
                for(let k = 0; k < sideNoteRows.length; k++){
                    if (sideNoteRows[k].innerHTML.includes(movieAdds[j].value)){
                        addNoteRows[j].style.display = "none";
                    }
                }
            }
        }
    }
}
toggleAddMovieSideNoteDisplay();
</script>

<script>
function validateAddSideNote(inputElement){
    const movieId = inputElement.parentElement.querySelector('.movieAdd').value;

    if (inputElement.value.length === 0) {
        document.getElementById('Movie Sidenote Text ' + movieId).style.backgroundColor = "white";
        document.getElementById('Movie Sidenote Label ' + movieId).style.display = "";
        document.getElementById('Movie Sidenote Label ' + movieId).innerHTML = "Create a Sidenote";
        document.getElementById('Movie Sidenote Submit ' + movieId).type="hidden";
    }
     else if(inputElement.value.length < 10) {
        document.getElementById('Movie Sidenote Text ' + movieId).style.backgroundColor = "LightGray";
        document.getElementById('Movie Sidenote Label ' + movieId).style.display = "";
        document.getElementById('Movie Sidenote Label ' + movieId).innerHTML = "Keep Typing!";
        document.getElementById('Movie Sidenote Submit ' + movieId).type="hidden";
    }
    else if (inputElement.value.length > 2000) {
        document.getElementById('Movie Sidenote Text ' + movieId).style.backgroundColor = "red";
        document.getElementById('Movie Sidenote Label ' + movieId).style.display = "";
        document.getElementById('Movie Sidenote Label ' + movieId).innerHTML = "Sidenotes cannot exceed 2000 Characters";
        document.getElementById('Movie Sidenote Submit ' + movieId).type="hidden";
    }
    else {
        document.getElementById('Movie Sidenote Text ' + movieId).style.backgroundColor = "white";
        document.getElementById('Movie Sidenote Submit ' + movieId).type="submit";
        document.getElementById('Movie Sidenote Label ' + movieId).innerHTML = "Let your visitors know how this movie fits your collection.";
<!--        document.getElementById('Movie Sidenote Label ' + movieId).style.display = "none";-->
    }
}

function clearInputField(inputField){
    inputField.value = "";
    validateAddSideNote(inputField);
}

const clearButtons = document.querySelectorAll('[id^="Clear Button"]');
clearButtons.forEach((button) => {
    const movieId = button.id.split(" ")[2];
    const inputField = document.getElementById('Movie Sidenote Text ' + movieId);
    button.addEventListener("click", () => {
        clearInputField(inputField);
    document.getElementById('Movie Sidenote Text ' + movieId).style.backgroundColor = "white";
    document.getElementById('Movie Sidenote Label ' + movieId).style.display = "";
    document.getElementById('Movie Sidenote Label ' + movieId).innerHTML = "Create a Sidenote";
    });
});
</script>

<script>
function validateSideNoteEdit(inputElement){
    const movieId = inputElement.parentElement.querySelector('.movieEdit').value;

    if (inputElement.value.length === 0) {
        document.getElementById('Movie Sidenote Text To Edit ' + movieId).style.backgroundColor = "white";
        document.getElementById('Movie Sidenote Update Label ' + movieId).style.display = "";
        document.getElementById('Movie Sidenote Update Label ' + movieId).innerHTML = "Edit Sidenote";
        document.getElementById('Movie Sidenote Update ' + movieId).type="hidden";
    }
     else if(inputElement.value.length < 10) {
        document.getElementById('Movie Sidenote Text To Edit ' + movieId).style.backgroundColor = "LightGray";
        document.getElementById('Movie Sidenote Update Label ' + movieId).style.display = "";
        document.getElementById('Movie Sidenote Update Label ' + movieId).innerHTML = "Keep Typing!";
        document.getElementById('Movie Sidenote Update ' + movieId).type="hidden";
    }
    else if (inputElement.value.length > 2000) {
        document.getElementById('Movie Sidenote Text To Edit ' + movieId).style.backgroundColor = "red";
        document.getElementById('Movie Sidenote Update Label ' + movieId).style.display = "";
        document.getElementById('Movie Sidenote Update Label ' + movieId).innerHTML = "Sidenotes cannot exceed 2000 Characters";
        document.getElementById('Movie Sidenote Update ' + movieId).type="hidden";
    }
    else {
        document.getElementById('Movie Sidenote Text To Edit ' + movieId).style.backgroundColor = "white";
        document.getElementById('Movie Sidenote Update Label ' + movieId).type="submit";
        document.getElementById('Movie Sidenote Update Label ' + movieId).innerHTML = 'When you are finished, hit "Update Sidenote" below.';
        document.getElementById('Movie Sidenote Update ' + movieId).type="submit";
<!--        document.getElementById(''Movie Sidenote Update Label ' + movieId).style.display = "none";-->
    }
}

function clearInputField(inputField){
    inputField.value = "";
    validateEditSideNote(inputField);
}

const clearButton = document.querySelectorAll('[id^="Clear Button"]');
clearButton.forEach((button) => {
    const movieId = button.id.split(" ")[2];
    const inputField = document.getElementById('Movie Sidenote Text To Edit ' + movieId);
    button.addEventListener("click", () => {
        clearInputField(inputField);
    document.getElementById('Movie Sidenote Text To Edit ' + movieId).style.backgroundColor = "white";
    document.getElementById('Movie Sidenote Update Label ' + movieId).style.display = "";
    document.getElementById('Movie Sidenote Update Label ' + movieId).innerHTML = "Edit your Sidenote";
    });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const editClickable = document.getElementById('Movie Sidenote Update Label ' + ${movie.id}');
    const editTools = document.getElementById('Movie Sidenote Edit Form ' + ${movie.id}');

    editClickable.addEventListener('click', function() {
        if (editTools.style.display === 'none') {
            editTools.style.display = 'block';
            editClickable.innerText = '▼ Edit Sidenote';
        } else {
            editTools.style.display = 'none';
            editClickable.innerText = '▶ Edit Sidenote';
        }
    });
});
</script>


</body>
</html>


